Object.defineProperty(exports, '__esModule', { value: true });

var React = require('react');
var cn = require('classnames');
require('../../../../button/cssm');
var coreComponentsLink = require('../../../../link/cssm');
require('@alfalab/utils');
require('@alfalab/hooks');
require('../countdown-loader/index.module.css');
require('../countdown-loader/component.js');
require('../countdown/index.module.css');
var components_countdown_component = require('../countdown/component.js');
var coreComponentsLoader = require('../../../../loader/cssm');
var components_codeInput_component = require('../code-input/component.js');
require('../code-input/utils.js');
require('../code-input/index.module.css');
var styles = require('./index.module.css');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefaultLegacy(React);
var cn__default = /*#__PURE__*/_interopDefaultLegacy(cn);
var styles__default = /*#__PURE__*/_interopDefaultLegacy(styles);

var SignConfirmation = function (_a) {
    var _b;
    var codeChecking = _a.codeChecking, codeSending = _a.codeSending, smsHintVisible = _a.smsHintVisible, requiredCharAmount = _a.requiredCharAmount, countdownDuration = _a.countdownDuration, additionalContent = _a.additionalContent, hasPhoneMask = _a.hasPhoneMask, phone = _a.phone, inputValue = _a.code, error = _a.error, errorText = _a.errorText, title = _a.title, hasSmsCountdown = _a.hasSmsCountdown, inputRef = _a.inputRef, codeCheckingText = _a.codeCheckingText, codeSendingText = _a.codeSendingText, alignContent = _a.alignContent, noAttemptsLeftMessage = _a.noAttemptsLeftMessage, buttonRetryText = _a.buttonRetryText, countdownContent = _a.countdownContent, onInputFinished = _a.onInputFinished, onInputChange = _a.onInputChange, onSmsRetryClick = _a.onSmsRetryClick, onCountdownFinished = _a.onCountdownFinished, onSmsHintLinkClick = _a.onSmsHintLinkClick;
    var processing = codeChecking || codeSending;
    var displayedError = processing ? '' : errorText;
    var handleInputKeyDown = React.useCallback(function (event) {
        if (event.key === 'Enter') {
            onInputFinished({ code: event.target.value });
        }
    }, [onInputFinished]);
    var handleInputFinished = React.useCallback(function (code) {
        onInputFinished({ code: code });
        if (inputRef.current) {
            inputRef.current.blur();
        }
    }, [onInputFinished, inputRef]);
    var handleInputChange = React.useCallback(function (code) {
        if (code.length === requiredCharAmount) {
            handleInputFinished(code);
        }
        onInputChange({ code: code });
    }, [handleInputFinished, onInputChange, requiredCharAmount]);
    return (React__default['default'].createElement("div", { className: cn__default['default'](styles__default['default'].component, styles__default['default'][alignContent]) },
        typeof title === 'string' ? React__default['default'].createElement("span", { className: styles__default['default'].header }, title) : title,
        React__default['default'].createElement("div", { className: styles__default['default'].inputContainer },
            React__default['default'].createElement(components_codeInput_component.CodeInput, { processing: processing, error: error, value: inputValue, ref: inputRef, slotsCount: requiredCharAmount, className: styles__default['default'].codeInput, alignContent: alignContent, handleChange: handleInputChange, handleInputKeyDown: handleInputKeyDown }),
            displayedError && (React__default['default'].createElement("div", { className: styles__default['default'].error, role: 'alert' }, displayedError))),
        processing && (React__default['default'].createElement("div", { className: styles__default['default'].loaderWrap },
            React__default['default'].createElement(coreComponentsLoader.Loader, null),
            React__default['default'].createElement("span", { className: styles__default['default'].loaderText }, codeChecking ? codeCheckingText : codeSendingText))),
        hasSmsCountdown && (React__default['default'].createElement("div", { className: cn__default['default']('countdown', styles__default['default'].countdown, (_b = {}, _b[styles__default['default'].hidden] = processing, _b)) },
            React__default['default'].createElement(components_countdown_component.Countdown, { duration: countdownDuration, phone: phone, hasPhoneMask: hasPhoneMask, alignContent: alignContent, noAttemptsLeftMessage: noAttemptsLeftMessage, hasError: Boolean(displayedError), buttonRetryText: buttonRetryText, content: countdownContent, onRepeatSms: onSmsRetryClick, onCountdownFinished: onCountdownFinished }))),
        smsHintVisible && (React__default['default'].createElement("div", { className: styles__default['default'].smsComeLinkWrap },
            React__default['default'].createElement(coreComponentsLink.Link, { onClick: onSmsHintLinkClick, className: styles__default['default'].smsComeLink, view: 'secondary', pseudo: true }, "\u041D\u0435 \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435?"))),
        React__default['default'].createElement("div", null, additionalContent)));
};

exports.SignConfirmation = SignConfirmation;
