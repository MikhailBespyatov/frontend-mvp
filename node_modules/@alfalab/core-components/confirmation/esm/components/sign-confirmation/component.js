import React, { useCallback } from 'react';
import cn from 'classnames';
import '../../../../button/esm';
import { Link } from '../../../../link/esm';
import '@alfalab/utils';
import '@alfalab/hooks';
import '../countdown-loader/component.js';
import { Countdown } from '../countdown/component.js';
import { Loader } from '../../../../loader/esm';
import '../code-input/utils.js';
import { CodeInput } from '../code-input/component.js';

var styles = {"component":"confirmation__component_srlhu","countdown":"confirmation__countdown_srlhu","hidden":"confirmation__hidden_srlhu","header":"confirmation__header_srlhu","inputContainer":"confirmation__inputContainer_srlhu","smsComeLinkWrap":"confirmation__smsComeLinkWrap_srlhu","smsComeLink":"confirmation__smsComeLink_srlhu","error":"confirmation__error_srlhu","loaderWrap":"confirmation__loaderWrap_srlhu","loaderText":"confirmation__loaderText_srlhu","center":"confirmation__center_srlhu","codeInput":"confirmation__codeInput_srlhu"};
require('./index.css');

var SignConfirmation = function (_a) {
    var _b;
    var codeChecking = _a.codeChecking, codeSending = _a.codeSending, smsHintVisible = _a.smsHintVisible, requiredCharAmount = _a.requiredCharAmount, countdownDuration = _a.countdownDuration, additionalContent = _a.additionalContent, hasPhoneMask = _a.hasPhoneMask, phone = _a.phone, inputValue = _a.code, error = _a.error, errorText = _a.errorText, title = _a.title, hasSmsCountdown = _a.hasSmsCountdown, inputRef = _a.inputRef, codeCheckingText = _a.codeCheckingText, codeSendingText = _a.codeSendingText, alignContent = _a.alignContent, noAttemptsLeftMessage = _a.noAttemptsLeftMessage, buttonRetryText = _a.buttonRetryText, countdownContent = _a.countdownContent, onInputFinished = _a.onInputFinished, onInputChange = _a.onInputChange, onSmsRetryClick = _a.onSmsRetryClick, onCountdownFinished = _a.onCountdownFinished, onSmsHintLinkClick = _a.onSmsHintLinkClick;
    var processing = codeChecking || codeSending;
    var displayedError = processing ? '' : errorText;
    var handleInputKeyDown = useCallback(function (event) {
        if (event.key === 'Enter') {
            onInputFinished({ code: event.target.value });
        }
    }, [onInputFinished]);
    var handleInputFinished = useCallback(function (code) {
        onInputFinished({ code: code });
        if (inputRef.current) {
            inputRef.current.blur();
        }
    }, [onInputFinished, inputRef]);
    var handleInputChange = useCallback(function (code) {
        if (code.length === requiredCharAmount) {
            handleInputFinished(code);
        }
        onInputChange({ code: code });
    }, [handleInputFinished, onInputChange, requiredCharAmount]);
    return (React.createElement("div", { className: cn(styles.component, styles[alignContent]) },
        typeof title === 'string' ? React.createElement("span", { className: styles.header }, title) : title,
        React.createElement("div", { className: styles.inputContainer },
            React.createElement(CodeInput, { processing: processing, error: error, value: inputValue, ref: inputRef, slotsCount: requiredCharAmount, className: styles.codeInput, alignContent: alignContent, handleChange: handleInputChange, handleInputKeyDown: handleInputKeyDown }),
            displayedError && (React.createElement("div", { className: styles.error, role: 'alert' }, displayedError))),
        processing && (React.createElement("div", { className: styles.loaderWrap },
            React.createElement(Loader, null),
            React.createElement("span", { className: styles.loaderText }, codeChecking ? codeCheckingText : codeSendingText))),
        hasSmsCountdown && (React.createElement("div", { className: cn('countdown', styles.countdown, (_b = {}, _b[styles.hidden] = processing, _b)) },
            React.createElement(Countdown, { duration: countdownDuration, phone: phone, hasPhoneMask: hasPhoneMask, alignContent: alignContent, noAttemptsLeftMessage: noAttemptsLeftMessage, hasError: Boolean(displayedError), buttonRetryText: buttonRetryText, content: countdownContent, onRepeatSms: onSmsRetryClick, onCountdownFinished: onCountdownFinished }))),
        smsHintVisible && (React.createElement("div", { className: styles.smsComeLinkWrap },
            React.createElement(Link, { onClick: onSmsHintLinkClick, className: styles.smsComeLink, view: 'secondary', pseudo: true }, "\u041D\u0435 \u043F\u0440\u0438\u0445\u043E\u0434\u0438\u0442 \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u0435?"))),
        React.createElement("div", null, additionalContent)));
};

export { SignConfirmation };
