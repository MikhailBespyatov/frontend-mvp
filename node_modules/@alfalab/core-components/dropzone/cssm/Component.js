Object.defineProperty(exports, '__esModule', { value: true });

var React = require('react');
var cn = require('classnames');
var utils = require('./utils.js');
require('@alfalab/icons-glyph');
require('./components/overlay/index.module.css');
var components_overlay_Component = require('./components/overlay/Component.js');
var styles = require('./index.module.css');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefaultLegacy(React);
var cn__default = /*#__PURE__*/_interopDefaultLegacy(cn);
var styles__default = /*#__PURE__*/_interopDefaultLegacy(styles);

var Dropzone = function (_a) {
    var _b;
    var className = _a.className, children = _a.children, _c = _a.text, text = _c === void 0 ? 'Перетащите файлы' : _c, _d = _a.error, error = _d === void 0 ? false : _d, overlayVisible = _a.overlayVisible, _e = _a.Overlay, Overlay = _e === void 0 ? components_overlay_Component.Overlay : _e, onDragEnter = _a.onDragEnter, onDragLeave = _a.onDragLeave, onDragOver = _a.onDragOver, onDrop = _a.onDrop, _f = _a.block, block = _f === void 0 ? false : _f, disabled = _a.disabled, dataTestId = _a.dataTestId;
    var _g = React.useState(false), dragOver = _g[0], setDragOver = _g[1];
    /**
     * При ховере дочерних элементов срабатывает dragLeave, из-за чего пропадает оверлей
     * https://stackoverflow.com/a/21002544
     */
    var dragCounter = React.useRef(0);
    var handleDragOver = React.useCallback(function (event) {
        utils.preventAndStopEvent(event);
        if (disabled)
            return;
        if (onDragOver) {
            onDragOver(event);
        }
    }, [onDragOver, disabled]);
    var handleDragEnter = React.useCallback(function (event) {
        utils.preventAndStopEvent(event);
        if (disabled)
            return;
        dragCounter.current += 1;
        setDragOver(true);
        if (onDragEnter) {
            onDragEnter(event);
        }
    }, [disabled, onDragEnter]);
    var handleDragLeave = React.useCallback(function (event) {
        utils.preventAndStopEvent(event);
        if (disabled)
            return;
        dragCounter.current -= 1;
        if (dragCounter.current > 0)
            return;
        setDragOver(false);
        if (onDragLeave) {
            onDragLeave(event);
        }
    }, [disabled, onDragLeave]);
    var handleDrop = React.useCallback(function (event) {
        utils.preventAndStopEvent(event);
        if (disabled)
            return;
        setDragOver(false);
        dragCounter.current = 0;
        if (event.dataTransfer.files && event.dataTransfer.files.length > 0) {
            if (onDrop) {
                onDrop(event.dataTransfer.files);
            }
            event.dataTransfer.clearData();
        }
    }, [disabled, onDrop]);
    return (React__default['default'].createElement("div", { className: cn__default['default'](styles__default['default'].component, className, (_b = {},
            _b[styles__default['default'].dragOver] = dragOver,
            _b[styles__default['default'].error] = error,
            _b[styles__default['default'].block] = block,
            _b[styles__default['default'].disabled] = disabled,
            _b)), "data-test-id": dataTestId, onDragEnter: handleDragEnter, onDragLeave: handleDragLeave, onDragOver: handleDragOver, onDrop: handleDrop },
        children,
        Overlay && React__default['default'].createElement(Overlay, { text: text, visible: Boolean(dragOver || overlayVisible) })));
};

exports.Dropzone = Dropzone;
